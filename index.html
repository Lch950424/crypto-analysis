<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto 100x Pro Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.1.0/dist/browser.js"></script>
</head>
<body class="bg-black text-gray-200 p-4 font-sans">

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div class="bg-gray-900 p-4 rounded-lg border border-yellow-600 shadow-lg">
            <h3 class="text-yellow-500 text-sm font-bold">BTC è³‡é‡‘è²»ç‡ (Funding)</h3>
            <p id="btc-funding" class="text-2xl font-mono text-green-400">--%</p>
            <div id="funding-status" class="text-[10px] text-gray-500 mt-1 uppercase tracking-widest">Market Neutral</div>
        </div>
        
        <div class="bg-gray-900 p-4 rounded-lg border border-blue-600 shadow-lg">
            <h3 class="text-blue-400 text-sm font-bold">ETH 24h æ³¢å‹•ç‡ (ATR)</h3>
            <p id="eth-atr" class="text-2xl font-mono text-blue-300">--%</p>
            <p class="text-[10px] text-gray-500 mt-1">100x æ§“æ¡¿å®¹éŒ¯ç‡æ¥µä½</p>
        </div>

        <div class="bg-gray-900 p-4 rounded-lg border border-purple-600 shadow-lg md:col-span-2">
            <h3 class="text-purple-400 text-sm font-bold">Telegram è­¦å ±è¨­ç½® (åƒ…é™æœ¬åœ°å„²å­˜)</h3>
            <div class="flex gap-2 mt-2">
                <input id="tg-token" type="password" placeholder="Bot Token" class="bg-gray-800 text-xs p-2 rounded w-full border border-gray-700 focus:outline-none focus:border-purple-500">
                <input id="tg-chatid" type="text" placeholder="Chat ID" class="bg-gray-800 text-xs p-2 rounded w-full border border-gray-700 focus:outline-none focus:border-purple-500">
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
        <div class="h-[500px] bg-gray-900 rounded-lg overflow-hidden border border-gray-800">
            <div id="tradingview_btc" class="h-full"></div>
        </div>
        <div class="h-[500px] bg-gray-900 rounded-lg overflow-hidden border border-gray-800">
            <div id="tradingview_eth" class="h-full"></div>
        </div>
    </div>

    <div id="alert-panel" class="bg-red-950/20 border border-red-500/50 p-6 rounded-lg text-center backdrop-blur-sm">
        <h2 class="text-xl font-bold text-red-400 mb-2 italic underline decoration-red-500">ğŸš¨ 100x åˆç´„é«˜é¢¨éšªæ±ºç­–å€åŸŸ</h2>
        <p id="strategy-advice" class="text-base text-gray-300">æ­£åœ¨åˆ†æå³æ™‚ç›¤é¢æ•¸æ“š...</p>
        <div id="liquidation-zone" class="mt-4 text-xs text-yellow-500 opacity-80 font-mono"></div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        // 1. åˆå§‹åŒ– TradingView åœ–è¡¨
        new TradingView.widget({
            "autosize": true,
            "symbol": "BINANCE:BTCUSDT.P",
            "interval": "15",
            "timezone": "Etc/UTC",
            "theme": "dark",
            "style": "1",
            "locale": "zh_TW",
            "toolbar_bg": "#f1f3f6",
            "enable_publishing": false,
            "hide_side_toolbar": false,
            "allow_symbol_change": true,
            "container_id": "tradingview_btc"
        });

        new TradingView.widget({
            "autosize": true,
            "symbol": "BINANCE:ETHUSDT.P",
            "interval": "15",
            "theme": "dark",
            "container_id": "tradingview_eth"
        });

        // 2. ç²å–è³‡é‡‘è²»ç‡èˆ‡å¸‚å ´æ•¸æ“š
        async function updateMarketData() {
            try {
                // ç²å–æ°¸çºŒåˆç´„è³‡é‡‘è²»ç‡ (Binance Futures API)
                const fundRes = await fetch('https://fapi.binance.com/fapi/v1/premiumIndex?symbol=BTCUSDT');
                const fundData = await fundRes.json();
                const fundingRate = (parseFloat(fundData.lastFundingRate) * 100).toFixed(4);
                
                const fundingEl = document.getElementById('btc-funding');
                fundingEl.innerText = `${fundingRate}%`;

                // è³‡é‡‘è²»ç‡é‚è¼¯åˆ¤æ–·
                const statusEl = document.getElementById('funding-status');
                if (fundingRate > 0.03) {
                    fundingEl.className = "text-2xl font-mono text-red-500 animate-pulse";
                    statusEl.innerText = "ğŸš¨ å¤šé ­éæ–¼æ“æ“  (High Funding)";
                    sendTGAlert(`BTC è³‡é‡‘è²»ç‡éé«˜ (${fundingRate}%)ï¼Œæ³¨æ„ 100x å¤šå–®æ¸…ç®—é¢¨éšªï¼`);
                } else if (fundingRate < -0.03) {
                    fundingEl.className = "text-2xl font-mono text-blue-400 animate-pulse";
                    statusEl.innerText = "ğŸš¨ ç©ºé ­éæ–¼æ“æ“  (Negative Funding)";
                    sendTGAlert(`BTC è³‡é‡‘è²»ç‡æ¥µè²  (${fundingRate}%)ï¼Œå°å¿ƒç©ºé ­æ“ å£“è»‹ç©ºï¼`);
                } else {
                    fundingEl.className = "text-2xl font-mono text-green-400";
                    statusEl.innerText = "Market Neutral";
                }

                // ç²å– ATR / æ³¢å‹•ç‡ (é€é 24h Ticker ä¼°ç®—)
                const tickerRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=ETHUSDT');
                const tickerData = await tickerRes.json();
                const high = parseFloat(tickerData.highPrice);
                const low = parseFloat(tickerData.lowPrice);
                const last = parseFloat(tickerData.lastPrice);
                const volRange = (((high - low) / last) * 100).toFixed(2);
                
                document.getElementById('eth-atr').innerText = `${volRange}%`;

                updateStrategy(fundingRate, volRange, last);

            } catch (e) {
                console.error("æ•¸æ“šæŠ“å–å¤±æ•—", e);
            }
        }

        // 3. ç­–ç•¥å»ºè­°é‚è¼¯
        function updateStrategy(funding, vol, price) {
            const adviceEl = document.getElementById('strategy-advice');
            const liqEl = document.getElementById('liquidation-zone');
            
            // 100x æ§“æ¡¿çˆ†å€‰è·é›¢ç´„ç‚º 0.8% - 1%
            const upLiq = (price * 1.008).toFixed(2);
            const downLiq = (price * 0.992).toFixed(2);
            
            liqEl.innerHTML = `[100x é ä¼°æ¸…ç®—åƒè€ƒå€é–“] ä¸Šæ–¹: $${upLiq} | ä¸‹æ–¹: $${downLiq}`;

            if (vol > 4) {
                adviceEl.innerHTML = "<span class='text-red-500 font-bold'>ç¦æ­¢æ“ä½œï¼</span> ç•¶å‰æ³¢å‹•ç‡éå¤§ï¼Œ100x æ§“æ¡¿æ¥µæ˜“åœ¨å¹¾ç§’å…§æ»‘åƒ¹çˆ†å€‰ã€‚";
            } else if (funding > 0.04) {
                adviceEl.innerHTML = "ç­–ç•¥ï¼š<span class='text-red-400'>é€¢é«˜å°‹æ±‚åšç©ºæ©Ÿæœƒ</span>ã€‚è³‡é‡‘è²»ç‡éé«˜ï¼ŒèŠå®¶æœ‰å¼·çƒˆå‹•æ©Ÿå‘ä¸‹çµæ®ºå¤šé ­æ§“æ¡¿ã€‚";
            } else if (funding < -0.04) {
                adviceEl.innerHTML = "ç­–ç•¥ï¼š<span class='text-green-400'>é€¢ä½å°‹æ±‚åšå¤šæ©Ÿæœƒ</span>ã€‚å¸‚å ´æ¥µåº¦çœ‹ç©ºï¼Œå®¹æ˜“å‡ºç¾æš´åŠ›åå½ˆè»‹ç©ºã€‚";
            } else {
                adviceEl.innerText = "å¸‚å ´è™•æ–¼éœ‡ç›ªå€é–“ã€‚100x æ§“æ¡¿å»ºè­°åƒ…åœ¨æ”¯æ’/å£“åŠ›ä½é™„è¿‘é…åˆ RSI é€²è¡Œ 5 åˆ†é˜ç´šåˆ¥è¶…çŸ­ç·šæ“ä½œã€‚";
            }
        }

        // 4. Telegram ç™¼é€é‚è¼¯
        let lastAlertTime = 0;
        async function sendTGAlert(message) {
            const token = document.getElementById('tg-token').value;
            const chatId = document.getElementById('tg-chatid').value;
            const now = Date.now();

            // é˜²æ­¢ 5 åˆ†é˜å…§é‡è¤‡ç™¼é€ç›¸åŒè­¦å ±
            if (token && chatId && (now - lastAlertTime > 300000)) {
                try {
                    await fetch(`https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}`);
                    lastAlertTime = now;
                    console.log("TG Alert Sent");
                } catch (e) { console.error("TG Send Failed", e); }
            }
        }

        // å®šæ™‚æ›´æ–° (æ¯ 10 ç§’)
        setInterval(updateMarketData, 10000);
        updateMarketData();
    </script>
</body>
</html>
