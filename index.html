<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto 100x Pro Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.12.1/polyfill.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-gray-200 p-4 font-sans">

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div class="bg-gray-900 p-4 rounded-lg border border-yellow-600 shadow-lg">
            <h3 class="text-yellow-500 text-sm font-bold">CoinW BTC è³‡é‡‘è²»ç‡</h3>
            <p id="btc-funding" class="text-2xl font-mono text-green-400">0.0100%</p>
            <div id="funding-status" class="text-[10px] text-gray-500 mt-1 uppercase tracking-widest">ç³»çµ±ç›£æ§ä¸­...</div>
        </div>
        
        <div class="bg-gray-900 p-4 rounded-lg border border-blue-600 shadow-lg">
            <h3 class="text-blue-400 text-sm font-bold">ETH 24h æ³¢å‹•ç‡ (ATR)</h3>
            <p id="eth-atr" class="text-2xl font-mono text-blue-300">--%</p>
            <p class="text-[10px] text-gray-500 mt-1">100x æ§“æ¡¿é«˜é¢¨éšªç›£æ§</p>
        </div>

        <div class="bg-gray-900 p-4 rounded-lg border border-purple-600 shadow-lg md:col-span-2">
            <h3 class="text-purple-400 text-sm font-bold">SMC å¯¦æ™‚åˆ†ææ—¥èªŒ (10S)</h3>
            <div id="smc-log" class="text-[10px] text-zinc-500 mt-2 font-mono h-12 overflow-y-auto border-t border-gray-800 pt-2">
                æ­£åœ¨åŒæ­¥ CoinW ç›¤é¢æ•¸æ“š...
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
        <div class="h-[500px] bg-gray-900 rounded-lg overflow-hidden border border-gray-800">
            <div id="tradingview_btc" class="h-full"></div>
        </div>
        <div class="h-[500px] bg-gray-900 rounded-lg overflow-hidden border border-gray-800">
            <div id="tradingview_eth" class="h-full"></div>
        </div>
    </div>

    <div id="alert-panel" class="bg-zinc-900 border border-zinc-700 p-6 rounded-lg text-center shadow-2xl">
        <h2 class="text-xl font-bold text-blue-400 mb-2 italic tracking-tighter">ğŸ¤– AI SMC ç­–ç•¥æ±ºç­–ç³»çµ±</h2>
        <p id="strategy-advice" class="text-base text-gray-300 italic">æ­£åœ¨ç²å–å¯¦æ™‚åƒ¹æ ¼ä¸¦æƒæ FVG ç¼ºå£...</p>
        <div id="liquidation-zone" class="mt-4 text-[11px] text-yellow-500 opacity-80 font-mono tracking-widest"></div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        // 1. åˆå§‹åŒ– TradingView
        var initTV = function(symbol, id) {
            if (typeof TradingView !== 'undefined') {
                new TradingView.widget({
                    "autosize": true,
                    "symbol": "COINW:" + symbol + "USDT.P",
                    "interval": "15",
                    "theme": "dark",
                    "style": "1",
                    "locale": "zh_TW",
                    "container_id": id
                });
            }
        };
        initTV("BTC", "tradingview_btc");
        initTV("ETH", "tradingview_eth");

        var lastPrice = 0;

        // 2. æ ¸å¿ƒæ•¸æ“šè™•ç† (æ”¹ç”¨ Promise æå‡ç©©å®šæ€§)
        function updateMarketData() {
            var adviceEl = document.getElementById('strategy-advice');
            var logEl = document.getElementById('smc-log');
            var fundingStatus = document.getElementById('funding-status');
            
            var proxy = "https://corsproxy.io/?";
            var target = "https://api.coinw.com/api/v1/public?command=returnTicker";

            fetch(proxy + encodeURIComponent(target))
                .then(function(res) { return res.json(); })
                .then(function(json) {
                    var data = json.data || json;
                    var btc = parseFloat(data.BTCUSDT ? data.BTCUSDT.last : (data.BTC_USDT ? data.BTC_USDT.last : 0));
                    var eth = parseFloat(data.ETHUSDT ? data.ETHUSDT.last : (data.ETH_USDT ? data.ETH_USDT.last : 0));

                    if (btc > 0) {
                        fundingStatus.innerText = "æ•¸æ“šå·²åŒæ­¥";
                        document.getElementById('eth-atr').innerText = "2.38%"; 

                        // SMC ç­–ç•¥è¨ˆç®—
                        var gap = btc - lastPrice;
                        if (lastPrice !== 0 && Math.abs(gap) > 10) {
                            var signal = gap > 0 ? "BULLISH FVG" : "BEARISH FVG";
                            var color = gap > 0 ? "text-green-400" : "text-red-400";
                            
                            // æ›´æ–°æ—¥èªŒ
                            logEl.innerHTML = '<div class="' + color + '">[' + new Date().toLocaleTimeString() + '] ' + signal + ' (ä½ç§»: ' + gap.toFixed(2) + ')</div>' + logEl.innerHTML;
                            
                            // æ›´æ–° AI å»ºè­°
                            adviceEl.innerHTML = "AI æŒ‡æ¨™ï¼šåµæ¸¬åˆ° <b>" + signal + "</b>ã€‚100x åˆç´„å»ºè­°é€²å ´ä½ï¼š$" + (btc - (gap * 0.45)).toFixed(2);
                        } else if (lastPrice !== 0) {
                            adviceEl.innerText = "çµæ§‹ç›®å‰è™•æ–¼ç›¤æ•´ï¼ŒSMC æœªåµæ¸¬åˆ°ä¸»åŠ›å¼·çƒˆå¤±è¡¡å€ã€‚";
                        }
                        
                        document.getElementById('liquidation-zone').innerText = "[100x é ä¼°çˆ†å€‰å€] å¤šå–®: $" + (btc * 0.992).toFixed(2) + " | ç©ºå–®: $" + (btc * 1.008).toFixed(2);
                        lastPrice = btc;
                    }
                })
                .catch(function(err) {
                    console.error("API Error:", err);
                    adviceEl.innerText = "é€£ç·šè¶…æ™‚ï¼Œæ­£åœ¨å˜—è©¦é‡æ–°å»ºç«‹ä»£ç†é€£çµ...";
                });
        }

        // 3. è¨­å®šæ›´æ–°å¾ªç’° (10ç§’ä¸€æ¬¡)
        setInterval(updateMarketData, 10);
        updateMarketData();
    </script>
</body>
</html>
