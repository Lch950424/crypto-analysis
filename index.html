<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>CoinW 100x AI æˆ°é¬¥çµ‚ç«¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.1.0/dist/browser.js"></script>
    <style>
        .fvg-bull { background: rgba(34, 197, 94, 0.2); border-left: 2px solid #22c55e; }
        .fvg-bear { background: rgba(239, 68, 68, 0.2); border-left: 2px solid #ef4444; }
        .glow-green { text-shadow: 0 0 10px #22c55e; }
        .glow-red { text-shadow: 0 0 10px #ef4444; }
    </style>
</head>
<body class="bg-black text-white p-2">

    <div class="flex gap-4 mb-2">
        <div class="bg-gray-900 p-3 rounded flex-1 border-l-4 border-yellow-500">
            <span class="text-xs text-gray-400">CoinW BTC/USDT</span>
            <div id="btc-price" class="text-3xl font-mono font-bold tracking-tighter">0.00</div>
        </div>
        <div class="bg-gray-900 p-3 rounded flex-1 border-l-4 border-blue-500">
            <span class="text-xs text-gray-400">CoinW ETH/USDT</span>
            <div id="eth-price" class="text-3xl font-mono font-bold tracking-tighter">0.00</div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
        <div class="bg-gray-900 p-4 rounded h-48 overflow-y-auto border border-gray-800">
            <h3 class="text-green-400 font-bold text-sm mb-2">FVG / IFVG æª¢æ¸¬å™¨</h3>
            <div id="fvg-logs" class="text-[10px] space-y-1 font-mono"></div>
        </div>
        <div class="bg-gray-900 p-4 rounded h-48 border border-gray-800">
            <h3 class="text-purple-400 font-bold text-sm mb-2">SMC Smart Money (LuxAlgo Style)</h3>
            <div id="smc-data" class="text-xs space-y-2">
                <p>BOS (çµæ§‹çªç ´): <span id="bos-status" class="text-gray-500">æƒæä¸­...</span></p>
                <p>Order Block (ä¸»åŠ›æ›å–®å€): <span id="ob-zone" class="text-gray-500">ç­‰å¾…ç¢ºèª...</span></p>
            </div>
        </div>
    </div>

    <div class="bg-blue-900/20 border border-blue-500 p-4 rounded-lg">
        <div class="flex justify-between items-center mb-2">
            <h2 class="text-lg font-bold text-blue-300 italic">ğŸ¤– AI 100x ç­–ç•¥å»ºè­°</h2>
            <span class="text-[10px] bg-blue-500 px-2 py-1 rounded">å¯¦æ™‚è¨ˆç®—ä¸­</span>
        </div>
        <div id="ai-advice" class="text-sm leading-relaxed text-blue-100">
            æ­£åœ¨æ”¶é›† CoinW æ·±åº¦åœ–èˆ‡ K ç·šæ•¸æ“š...
        </div>
        <div id="trade-params" class="mt-3 grid grid-cols-2 gap-2 text-xs font-mono">
            <div class="p-2 bg-black/40 rounded">å…¥å ´: <span id="entry-p" class="text-white">--</span></div>
            <div class="p-2 bg-black/40 rounded">æ­¢æ: <span id="sl-p" class="text-red-400">--</span></div>
        </div>
    </div>

    <script>
        let klines = []; // å­˜å„² K ç·šæ•¸æ“šç”¨æ–¼æŒ‡æ¨™è¨ˆç®—
        const MAX_KLINES = 100;

        // 1. CoinW WebSocket é€£æ¥ (æ¨¡æ“¬å¯¦ç¾ï¼Œå…·é«”è·¯å¾‘éœ€åƒç…§ CoinW å¯¦æ™‚æ–‡æª”)
        function initCoinWWS() {
            // æ³¨æ„ï¼šå¯¦éš› CoinW WS éœ€è¦è™•ç†è¨‚é–±æ¶ˆæ¯ï¼Œæ­¤è™•ç‚ºçµæ§‹æ¼”ç¤º
            const socket = new WebSocket('wss://api.coinw.com/ws/public'); 

            socket.onopen = () => {
                console.log("CoinW Connected");
                // è¨‚é–± BTC å’Œ ETH çš„ Ticker èˆ‡ KLine
                socket.send(JSON.stringify({"op": "sub", "topic": "spot/ticker:BTCUSDT"}));
                socket.send(JSON.stringify({"op": "sub", "topic": "spot/candle1m:BTCUSDT"}));
            };

            socket.onmessage = (event) => {
                const msg = JSON.parse(event.data);
                if (msg.topic === 'spot/ticker:BTCUSDT') {
                    updatePrice('btc', msg.data.last);
                }
                if (msg.topic === 'spot/candle1m:BTCUSDT') {
                    processKLine(msg.data);
                }
            };
        }

        // 2. æ ¸å¿ƒæŒ‡æ¨™è¨ˆç®— (FVG / SMC)
        function processKLine(candle) {
            klines.push(candle);
            if (klines.length > MAX_KLINES) klines.shift();
            if (klines.length < 3) return;

            const i = klines.length - 1;
            const c1 = klines[i-2], c2 = klines[i-1], c3 = klines[i];

            // --- FVG é‚è¼¯ ---
            // çœ‹å¤š FVG: ç¬¬ä¸€æ ¹é«˜é» < ç¬¬ä¸‰æ ¹ä½é»
            if (c1.high < c3.low) {
                logFVG("Bullish FVG", c1.high, c3.low, "green");
            }
            // çœ‹ç©º FVG: ç¬¬ä¸€æ ¹ä½é» > ç¬¬ä¸‰æ ¹é«˜é»
            if (c1.low > c3.high) {
                logFVG("Bearish FVG", c1.low, c3.high, "red");
            }

            // --- SMC é‚è¼¯ (ç°¡åŒ–) ---
            detectSMC(klines);
            generateAIAdvice(klines);
        }

        function logFVG(type, top, bottom, color) {
            const log = document.getElementById('fvg-logs');
            const div = document.createElement('div');
            div.className = `p-1 border-l-2 border-${color}-500 bg-${color}-500/10 mb-1`;
            div.innerText = `[${new Date().toLocaleTimeString()}] ${type}: ${bottom} - ${top}`;
            log.prepend(div);
        }

        function detectSMC(data) {
            // åµæ¸¬ BOS: ç•¶å‰åƒ¹æ ¼çªç ´äº†å‰é«˜/å‰ä½
            const lastHigh = data[data.length-10].high; 
            if (data[data.length-1].close > lastHigh) {
                document.getElementById('bos-status').innerText = "ğŸ‚ çœ‹æ¼²çµæ§‹çªç ´ (BOS)";
                document.getElementById('bos-status').className = "text-green-500 font-bold";
            }
        }

        // 3. AI ç­–ç•¥ç”Ÿæˆå™¨ (é‡å° 100x æ§“æ¡¿)
        function generateAIAdvice(data) {
            const currentPrice = data[data.length-1].close;
            const adviceBox = document.getElementById('ai-advice');
            
            // é‚è¼¯åˆ¤æ–·ï¼šè‹¥æœ‰ FVG ä¸” BOS å‘ä¸Š
            const isBullish = document.getElementById('bos-status').innerText.includes("ğŸ‚");
            
            if (isBullish) {
                adviceBox.innerHTML = "åˆ†æçµæœï¼š<span class='text-green-400'>çµæ§‹çœ‹æ¼²</span>ã€‚å»ºè­°åœ¨ 15m FVG å›æ¸¬å€é–“æ›å¤šå–®ã€‚100x æ§“æ¡¿è«‹åš´æ ¼åŸ·è¡Œ 0.5% æ­¢æã€‚";
                document.getElementById('entry-p').innerText = (currentPrice * 0.998).toFixed(2);
                document.getElementById('sl-p').innerText = (currentPrice * 0.993).toFixed(2);
            } else {
                adviceBox.innerText = "ç›¤é¢æ•´ç†ä¸­ï¼Œæš«ç„¡é«˜å‹ç‡ 100x å…¥å ´ä¿¡è™Ÿã€‚å»ºè­°è§€æœ›ä¸»åŠ›åœ¨ Order Block çš„åæ‡‰ã€‚";
            }
        }

        function updatePrice(coin, price) {
            const el = document.getElementById(`${coin}-price`);
            const oldPrice = parseFloat(el.innerText);
            el.innerText = price;
            el.className = price > oldPrice ? "text-3xl font-mono font-bold tracking-tighter text-green-500 glow-green" : "text-3xl font-mono font-bold tracking-tighter text-red-500 glow-red";
        }

        // å•Ÿå‹•
        initCoinWWS();
        // æ¨¡æ“¬æ•¸æ“šæ¼”ç¤º (è‹¥ WS æœªé€£é€š)
        setInterval(() => {
            let mockPrice = (96000 + Math.random() * 100).toFixed(2);
            updatePrice('btc', mockPrice);
        }, 100); 
    </script>
</body>
</html>
