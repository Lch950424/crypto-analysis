<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>CoinW 100x AI 戰略終端</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body class="bg-black text-gray-200 p-2 font-mono h-screen flex flex-col">

    <div class="grid grid-cols-2 gap-2 mb-2">
        <div class="bg-zinc-900 p-3 rounded-lg border-l-4 border-green-500 shadow-inner">
            <span class="text-[10px] text-gray-500 block">COINW BTCUSDT PERP</span>
            <div id="btc-price" class="text-3xl font-bold tracking-tighter text-green-400">LOADING...</div>
            <div id="btc-funding" class="text-[10px] text-zinc-500 mt-1">Funding: --%</div>
        </div>
        <div class="bg-zinc-900 p-3 rounded-lg border-l-4 border-blue-500 shadow-inner">
            <span class="text-[10px] text-gray-500 block">COINW ETHUSDT PERP</span>
            <div id="eth-price" class="text-3xl font-bold tracking-tighter text-blue-400">LOADING...</div>
            <div id="eth-funding" class="text-[10px] text-zinc-500 mt-1">Funding: --%</div>
        </div>
    </div>

    <div class="flex-1 grid grid-cols-1 md:grid-cols-3 gap-2 min-h-0">
        <div class="md:col-span-2 bg-zinc-900 rounded-lg p-2 border border-zinc-800 relative">
            <div class="absolute top-2 right-2 flex gap-2 z-10">
                <span class="bg-black/50 px-2 py-0.5 rounded text-[10px] text-purple-400 border border-purple-500/50">SMC: ON</span>
                <span class="bg-black/50 px-2 py-0.5 rounded text-[10px] text-orange-400 border border-orange-500/50">FVG: ON</span>
            </div>
            <div id="main-chart" class="w-full h-full"></div>
        </div>
        
        <div class="bg-zinc-900 rounded-lg p-3 border border-zinc-800 flex flex-col">
            <h3 class="text-xs font-bold text-yellow-500 mb-2 flex items-center gap-1">
                <span class="animate-pulse">●</span> AI 100x 動態建議
            </h3>
            <div id="ai-advice" class="text-[11px] leading-relaxed text-zinc-400 overflow-y-auto flex-1 space-y-2">
                正在分析 CoinW 盤口流動性...
            </div>
            <div class="mt-2 pt-2 border-t border-zinc-800">
                <div class="flex justify-between text-[10px]">
                    <span class="text-zinc-500">建議方向:</span>
                    <span id="rec-side" class="font-bold">--</span>
                </div>
                <div class="flex justify-between text-[10px]">
                    <span class="text-zinc-500">建議掛單:</span>
                    <span id="rec-entry" class="text-white">--</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化圖表
        const chart = LightweightCharts.createChart(document.getElementById('main-chart'), {
            layout: { background: { color: '#18181b' }, textColor: '#71717a' },
            grid: { vertLines: { color: '#27272a' }, horzLines: { color: '#27272a' } },
            timeScale: { timeVisible: true, secondsVisible: true }
        });
        const candleSeries = chart.addCandlestickSeries({
            upColor: '#22c55e', downColor: '#ef4444', borderVisible: false,
            wickUpColor: '#22c55e', wickDownColor: '#ef4444'
        });

        // 每秒呼叫 CoinW API (此處為模擬 CoinW 合約請求結構)
        async function fetchCoinW() {
            try {
                // 實際部署時替換為 CoinW API URL
                // const res = await fetch('https://api.coinw.com/api/v1/public?command=returnTicker');
                
                const mockBTC = 96000 + Math.random() * 20;
                const mockETH = 2400 + Math.random() * 5;

                updateUI('btc', mockBTC);
                updateUI('eth', mockETH);
                
                // 模擬 K 線數據更新
                const now = Math.floor(Date.now() / 1000);
                candleSeries.update({
                    time: now,
                    open: mockBTC - 2,
                    high: mockBTC + 5,
                    low: mockBTC - 10,
                    close: mockBTC
                });

                runAIEngine(mockBTC, mockETH);
            } catch (e) { console.error("API Error", e); }
        }

        function updateUI(coin, price) {
            const el = document.getElementById(`${coin}-price`);
            const oldPrice = parseFloat(el.innerText) || 0;
            el.innerText = price.toFixed(2);
            el.className = price >= oldPrice ? "text-3xl font-bold tracking-tighter text-green-400" : "text-3xl font-bold tracking-tighter text-red-400";
        }

        // FVG & SMC 邏輯引擎
        function runAIEngine(btc, eth) {
            const adviceBox = document.getElementById('ai-advice');
            // 隨機模擬 SMC 偵測 (實際應根據歷史 K 線計算)
            const signals = [
                "偵測到下方 $95,800 存在多頭 Order Block。",
                "FVG 缺口已回補，100x 空單注意止盈。",
                "BOS 結構向上突破，回踩 FVG 可嘗試做多。"
            ];
            
            if (Math.random() > 0.8) {
                const msg = signals[Math.floor(Math.random() * signals.length)];
                const div = document.createElement('div');
                div.className = "border-l-2 border-yellow-500 pl-2 mb-2 italic";
                div.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
                adviceBox.prepend(div);
                
                // 更新建議
                document.getElementById('rec-side').innerText = btc > 96000 ? "LONG (做多)" : "SHORT (做空)";
                document.getElementById('rec-entry').innerText = btc.toFixed(2);
            }
        }

        setInterval(fetchCoinW, 1000); // 每秒更新
    </script>
</body>
</html>
