<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto 100x Pro Dashboard - CoinW Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/technicalindicators@3.1.0/dist/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-polyfill/7.12.1/polyfill.min.js"></script>
</head>
<body class="bg-black text-gray-200 p-4 font-sans">

    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div class="bg-gray-900 p-4 rounded-lg border border-yellow-600 shadow-lg">
            <h3 class="text-yellow-500 text-sm font-bold">CoinW BTC è³‡é‡‘è²»ç‡</h3>
            <p id="btc-funding" class="text-2xl font-mono text-green-400">--%</p>
            <div id="funding-status" class="text-[10px] text-gray-500 mt-1 uppercase tracking-widest">Market Neutral</div>
        </div>
        
        <div class="bg-gray-900 p-4 rounded-lg border border-blue-600 shadow-lg">
            <h3 class="text-blue-400 text-sm font-bold">ETH 24h æ³¢å‹•ç‡ (ATR)</h3>
            <p id="eth-atr" class="text-2xl font-mono text-blue-300">--%</p>
            <p class="text-[10px] text-gray-500 mt-1">100x æ§“æ¡¿å®¹éŒ¯ç‡æ¥µä½</p>
        </div>

        <div class="bg-gray-900 p-4 rounded-lg border border-purple-600 shadow-lg md:col-span-2">
            <h3 class="text-purple-400 text-sm font-bold">Telegram è­¦å ±èˆ‡ SMC æ—¥èªŒ</h3>
            <div class="flex gap-2 mt-2">
                <input id="tg-token" type="password" placeholder="Bot Token" class="bg-gray-800 text-xs p-2 rounded w-full border border-gray-700">
                <input id="tg-chatid" type="text" placeholder="Chat ID" class="bg-gray-800 text-xs p-2 rounded w-full border border-gray-700">
            </div>
            <div id="smc-log" class="text-[9px] text-zinc-500 mt-2 font-mono h-8 overflow-hidden">ç­‰å¾…æ•¸æ“šæµå…¥åˆ†æ FVG/SMC...</div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
        <div class="h-[500px] bg-gray-900 rounded-lg overflow-hidden border border-gray-800">
            <div id="tradingview_btc" class="h-full"></div>
        </div>
        <div class="h-[500px] bg-gray-900 rounded-lg overflow-hidden border border-gray-800">
            <div id="tradingview_eth" class="h-full"></div>
        </div>
    </div>

    <div id="alert-panel" class="bg-zinc-900/50 border border-zinc-700 p-6 rounded-lg text-center backdrop-blur-sm">
        <h2 class="text-xl font-bold text-blue-400 mb-2 italic tracking-tighter">ğŸ¤– AI SMC ç­–ç•¥æ±ºç­–ç³»çµ±</h2>
        <p id="strategy-advice" class="text-base text-gray-300">æ­£åœ¨åŒæ­¥ CoinW è¨‚å–®ç°¿èˆ‡ K ç·š...</p>
        <div id="liquidation-zone" class="mt-4 text-[10px] text-yellow-500/80 font-mono"></div>
        <div id="fvg-zone" class="mt-1 text-[10px] text-orange-400 font-mono italic"></div>
    </div>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        // 1. åˆå§‹åŒ– TradingView åœ–è¡¨ (è¨­å®šç‚º CoinW æ•¸æ“šæº)
        const tvConfig = (symbol, container) => ({
            "autosize": true,
            "symbol": `COINW:${symbol}USDT.P`,
            "interval": "15",
            "timezone": "Etc/UTC",
            "theme": "dark",
            "style": "1",
            "locale": "zh_TW",
            "enable_publishing": false,
            "hide_side_toolbar": false,
            "allow_symbol_change": true,
            "container_id": container
        });

        new TradingView.widget(tvConfig("BTC", "tradingview_btc"));
        new TradingView.widget(tvConfig("ETH", "tradingview_eth"));

        let priceHistory = [];

        // 2. æ ¸å¿ƒæ•¸æ“šç²å– (ä½¿ç”¨ 10ç§’ æ›´æ–°é »ç‡)
        async function updateMarketData() {
            try {
                // ä½¿ç”¨ Proxy è§£æ±ºç€è¦½å™¨ CORS å•é¡Œ
                const proxy = "https://corsproxy.io/?";
                const target = "https://api.coinw.com/api/v1/public?command=returnTicker";
                const response = await fetch(proxy + encodeURIComponent(target));
                const json = await response.json();
                const data = json.data || json;

                // ç²å–åƒ¹æ ¼
                const btcPrice = parseFloat(data.BTCUSDT?.last || 0);
                const ethPrice = parseFloat(data.ETHUSDT?.last || 0);
                
                // æ¨¡æ“¬/ç²å–è³‡é‡‘è²»ç‡ (CoinW å¸¸è¦‹ç‚º 0.01%)
                const fundingRate = 0.0100; 
                document.getElementById('btc-funding').innerText = `${fundingRate}%`;

                // ç²å– ATR æ³¢å‹•ç‡æ¨¡æ“¬ (24h é«˜ä½å·®)
                const ethHigh = parseFloat(data.ETHUSDT?.high || 0);
                const ethLow = parseFloat(data.ETHUSDT?.low || 0);
                const volRange = (((ethHigh - ethLow) / ethPrice) * 100).toFixed(2);
                document.getElementById('eth-atr').innerText = `${volRange}%`;

                // æ›´æ–° SMC/FVG é‚è¼¯
                if (btcPrice > 0) {
                    priceHistory.push(btcPrice);
                    if (priceHistory.length > 10) priceHistory.shift();
                    analyzeSMC(btcPrice, volRange);
                }

            } catch (e) {
                console.error("CoinW API è«‹æ±‚å¤±æ•—", e);
                document.getElementById('strategy-advice').innerText = "API è«‹æ±‚å—é˜»ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ä»£ç†ä¼ºæœå™¨...";
            }
        }

        // 3. SMC & FVG æŒ‡æ¨™é‹ç®—é‚è¼¯
        function analyzeSMC(currentPrice, vol) {
            const adviceEl = document.getElementById('strategy-advice');
            const liqEl = document.getElementById('liquidation-zone');
            const fvgEl = document.getElementById('fvg-zone');
            const logEl = document.getElementById('smc-log');

            // 100x çˆ†å€‰ç·šè¨ˆç®— (0.8% è·é›¢)
            const upLiq = (currentPrice * 1.008).toFixed(2);
            const downLiq = (currentPrice * 0.992).toFixed(2);
            liqEl.innerHTML = `[100x é ä¼°çˆ†å€‰ä½] å¤šå–®: $${downLiq} | ç©ºå–®: $${upLiq}`;

            // ç°¡æ˜“ FVG æª¢æ¸¬ (åµæ¸¬ 10ç§’ å…§çš„åŠ‡çƒˆä½ç§»)
            const prevPrice = priceHistory[priceHistory.length - 2] || currentPrice;
            const priceGap = currentPrice - prevPrice;
            
            if (Math.abs(priceGap) > 50) {
                const type = priceGap > 0 ? "BULLISH FVG" : "BEARISH FVG";
                fvgEl.innerText = `âš ï¸ åµæ¸¬åˆ° ${type}: åƒ¹æ ¼å¤±è¡¡å€é–“ $${prevPrice.toFixed(2)} - $${currentPrice.toFixed(2)}`;
                logEl.innerText = `[${new Date().toLocaleTimeString()}] SMC Alert: ${type} Detected.`;
            }

            // AI æ±ºç­–é‚è¼¯
            if (vol > 5) {
                adviceEl.innerHTML = "<span class='text-red-500 font-bold'>ğŸš¨ é«˜æ³¢å‹•è­¦å‘Šï¼š</span> ATR éå¤§ï¼Œ100x æ§“æ¡¿æ¥µæ˜“å› æ’é‡ç›´æ¥çˆ†å€‰ï¼Œå»ºè­°è§€æœ›ã€‚";
            } else if (priceGap > 30) {
                adviceEl.innerHTML = "ç­–ç•¥ï¼š<span class='text-green-400'>è¿½éš¨è¶¨å‹¢</span>ã€‚SMC é¡¯ç¤ºçµæ§‹å‘ä¸Šçªç ´ (BOS)ï¼Œå›è¸© FVG ç¼ºå£å¯åšå¤šã€‚";
            } else if (priceGap < -30) {
                adviceEl.innerHTML = "ç­–ç•¥ï¼š<span class='text-red-400'>çµæ§‹èµ°å£</span>ã€‚å‡ºç¾ç©ºé ­å…¬å…åƒ¹å€¼ç¼ºå£ï¼Œåå½ˆè‡³ç¼ºå£è™•å¯é€²å ´çŸ­ç©ºã€‚";
            } else {
                adviceEl.innerText = "çµæ§‹ç›¤æ•´ã€‚SMC é¡¯ç¤ºä¸»åŠ›æ­£åœ¨æ©«ç›¤å¸ç±Œï¼Œ100x æ§“æ¡¿å»ºè­°ç­‰å¾… BOS çµæ§‹çªç ´å¾Œé€²å ´ã€‚";
            }
        }

        // 4. Telegram ç™¼é€ (åŒåŸé‚è¼¯)
        let lastAlertTime = 0;
        async function sendTGAlert(message) {
            const token = document.getElementById('tg-token').value;
            const chatId = document.getElementById('tg-chatid').value;
            const now = Date.now();
            if (token && chatId && (now - lastAlertTime > 300000)) {
                try {
                    await fetch(`https://api.telegram.org/bot${token}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}`);
                    lastAlertTime = now;
                } catch (e) { console.error("TG å¤±æ•—", e); }
            }
        }

        // æ¯ 10 ç§’æ›´æ–°
        setInterval(updateMarketData, 10);
        updateMarketData();
    </script>
</body>
</html>
